2024-11-28 16:55:07,588 - app - INFO - Loaded 10 scenes
2024-11-28 16:55:07,588 - app - INFO - Validating scene: dust_control - 粉尘控制
2024-11-28 16:55:07,588 - app - ERROR - Scene validation failed: Scene dust_control has invalid risk level
2024-11-28 16:55:07,588 - app - ERROR - Scene validation failed, aborting initialization
2024-11-28 17:02:45,148 - app - INFO - Loaded 10 scenes
2024-11-28 17:02:45,149 - app - INFO - Validating scene: dust_control - 粉尘控制
2024-11-28 17:02:45,149 - app - ERROR - Scene validation failed: Scene dust_control has invalid risk level
2024-11-28 17:02:45,149 - app - ERROR - Scene validation failed, aborting initialization
2024-11-28 17:04:36,660 - app - INFO - Loaded 10 scenes
2024-11-28 17:04:36,660 - app - INFO - Validating scene: dust_control - 粉尘控制
2024-11-28 17:04:36,660 - app - ERROR - Scene validation failed: Scene dust_control has invalid risk level
2024-11-28 17:04:36,660 - app - ERROR - Scene validation failed, aborting initialization
2024-11-28 17:05:47,792 - app - INFO - Loaded 10 scenes
2024-11-28 17:05:47,792 - app - INFO - Validating scene: dust_control - 粉尘控制
2024-11-28 17:05:47,792 - app - ERROR - Scene validation failed: Scene dust_control has invalid risk level
2024-11-28 17:05:47,792 - app - ERROR - Scene validation failed, aborting initialization
2024-11-28 17:07:48,395 - app - INFO - Loaded 10 scenes
2024-11-28 17:07:48,395 - app - INFO - Validating scene: dust_control - 粉尘控制
2024-11-28 17:07:48,395 - app - ERROR - Scene validation failed: Scene dust_control has invalid risk level
2024-11-28 17:07:48,395 - app - ERROR - Scene validation failed, aborting initialization
2024-11-28 17:08:49,229 - app - INFO - Loaded 10 scenes
2024-11-28 17:08:49,229 - app - INFO - Validating scene: dust_control - 粉尘控制
2024-11-28 17:08:49,230 - app - ERROR - Scene validation failed: Scene dust_control has invalid risk level
2024-11-28 17:08:49,230 - app - ERROR - Scene validation failed, aborting initialization
2024-11-28 17:10:03,307 - app - INFO - Loaded 10 scenes
2024-11-28 17:10:03,307 - app - INFO - Validating scene: dust_control - 粉尘控制
2024-11-28 17:10:03,308 - app - ERROR - Scene validation failed: Scene dust_control has invalid risk level
2024-12-02 15:00:33,951 - app.services.scene_tracker - INFO - No history found for scene 123
2024-12-02 15:00:47,277 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-02 15:00:47,288 - app.services.scene_tracker - INFO - Creating new scene record for 123
2024-12-02 15:00:47,289 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-02 15:00:47,289 - app.services.scene_tracker - INFO - Updated state for scene 123
2024-12-02 15:01:14,160 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-02 15:01:14,166 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-02 15:01:14,166 - app.services.scene_tracker - INFO - Updated state for scene 123
2024-12-02 15:01:56,351 - openai._base_client - INFO - Retrying request to /chat/completions in 0.440296 seconds
2024-12-02 15:02:15,658 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-02 15:02:15,660 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-02 15:02:15,660 - app.services.scene_tracker - INFO - Updated state for scene 123
2024-12-02 15:02:46,324 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-02 15:02:46,328 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-02 15:02:46,328 - app.services.scene_tracker - INFO - Updated state for scene 123
2024-12-02 15:11:27,514 - app.services.scene_tracker - INFO - No history found for scene 001
2024-12-02 15:11:39,144 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-02 15:11:39,155 - app.services.scene_tracker - INFO - Creating new scene record for 001
2024-12-02 15:11:39,156 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-02 15:11:39,157 - app.services.scene_tracker - INFO - Updated state for scene 001
2024-12-02 15:12:15,747 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-02 15:12:15,750 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-02 15:12:15,750 - app.services.scene_tracker - INFO - Updated state for scene 001
2024-12-02 15:12:50,946 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-02 15:12:50,950 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-02 15:12:50,950 - app.services.scene_tracker - INFO - Updated state for scene 001
2024-12-02 15:13:08,477 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-02 15:13:08,483 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-02 15:13:08,483 - app.services.scene_tracker - INFO - Updated state for scene 001
2024-12-03 11:06:50,576 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2024-12-03 11:06:50,579 - sqlalchemy.engine.Engine - INFO - SELECT cameras.camera_id, cameras.camera_name, cameras.group_id, cameras.location, cameras.status, cameras.description, cameras.id, cameras.created_at, cameras.updated_at 
FROM cameras
2024-12-03 11:06:50,579 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ()
2024-12-03 11:06:50,583 - sqlalchemy.engine.Engine - INFO - SELECT cameras_1.id AS cameras_1_id, camera_scenes.camera_id AS camera_scenes_camera_id, camera_scenes.scene_id AS camera_scenes_scene_id, camera_scenes.id AS camera_scenes_id, camera_scenes.created_at AS camera_scenes_created_at, camera_scenes.updated_at AS camera_scenes_updated_at 
FROM cameras AS cameras_1 JOIN camera_scenes ON cameras_1.camera_id = camera_scenes.camera_id 
WHERE cameras_1.id IN (?, ?)
2024-12-03 11:06:50,584 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (1, 2)
2024-12-03 11:06:50,586 - sqlalchemy.engine.Engine - INFO - SELECT cameras_1.id AS cameras_1_id, hazards.hazard_id AS hazards_hazard_id, hazards.camera_id AS hazards_camera_id, hazards.scene_id AS hazards_scene_id, hazards.location AS hazards_location, hazards.violation_type AS hazards_violation_type, hazards.risk_level AS hazards_risk_level, hazards.status AS hazards_status, hazards.detected_at AS hazards_detected_at, hazards.resolved_at AS hazards_resolved_at, hazards.id AS hazards_id, hazards.created_at AS hazards_created_at, hazards.updated_at AS hazards_updated_at 
FROM cameras AS cameras_1 JOIN hazards ON cameras_1.camera_id = hazards.camera_id 
WHERE cameras_1.id IN (?, ?)
2024-12-03 11:06:50,587 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (1, 2)
2024-12-03 11:06:50,588 - sqlalchemy.engine.Engine - INFO - COMMIT
2024-12-03 11:07:03,799 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2024-12-03 11:07:03,800 - sqlalchemy.engine.Engine - INFO - SELECT cameras.camera_id, cameras.camera_name, cameras.group_id, cameras.location, cameras.status, cameras.description, cameras.id, cameras.created_at, cameras.updated_at 
FROM cameras 
WHERE cameras.camera_id = ?
2024-12-03 11:07:03,800 - sqlalchemy.engine.Engine - INFO - [generated in 0.00011s] ('001',)
2024-12-03 11:07:03,801 - sqlalchemy.engine.Engine - INFO - SELECT cameras_1.id AS cameras_1_id, camera_scenes.camera_id AS camera_scenes_camera_id, camera_scenes.scene_id AS camera_scenes_scene_id, camera_scenes.id AS camera_scenes_id, camera_scenes.created_at AS camera_scenes_created_at, camera_scenes.updated_at AS camera_scenes_updated_at 
FROM cameras AS cameras_1 JOIN camera_scenes ON cameras_1.camera_id = camera_scenes.camera_id 
WHERE cameras_1.id IN (?)
2024-12-03 11:07:03,801 - sqlalchemy.engine.Engine - INFO - [cached since 13.22s ago] (2,)
2024-12-03 11:07:03,802 - sqlalchemy.engine.Engine - INFO - SELECT cameras_1.id AS cameras_1_id, hazards.hazard_id AS hazards_hazard_id, hazards.camera_id AS hazards_camera_id, hazards.scene_id AS hazards_scene_id, hazards.location AS hazards_location, hazards.violation_type AS hazards_violation_type, hazards.risk_level AS hazards_risk_level, hazards.status AS hazards_status, hazards.detected_at AS hazards_detected_at, hazards.resolved_at AS hazards_resolved_at, hazards.id AS hazards_id, hazards.created_at AS hazards_created_at, hazards.updated_at AS hazards_updated_at 
FROM cameras AS cameras_1 JOIN hazards ON cameras_1.camera_id = hazards.camera_id 
WHERE cameras_1.id IN (?)
2024-12-03 11:07:03,802 - sqlalchemy.engine.Engine - INFO - [cached since 13.22s ago] (2,)
2024-12-03 11:07:03,954 - ai_service - INFO - 处理后的图片大小: 284564 bytes
2024-12-03 11:07:03,955 - ai_service - INFO - ==================================================
2024-12-03 11:07:03,955 - ai_service - INFO - 分析开始时间: 2024-12-03 11:07:03
2024-12-03 11:07:03,955 - ai_service - INFO - 摄像头ID: 001
2024-12-03 11:07:03,955 - ai_service - INFO - 摄像头位置: 测试摄像头
2024-12-03 11:07:03,955 - ai_service - INFO - 关联场景: excavation_edge_protection, ppe_violation, crane_operation
2024-12-03 11:07:03,955 - ai_service - INFO - 活跃隐患数: 13
2024-12-03 11:07:03,955 - ai_service - INFO - --------------------------------------------------
2024-12-03 11:07:03,955 - ai_service - INFO - 完整提示词:
2024-12-03 11:07:03,955 - ai_service - INFO - 你是一位专业的建筑工地安全检查员，正在通过摄像头 测试摄像头（位于测试摄像头）监控施工现场。请注意：
1. 仔细观察图片细节，避免误判
2. 每个违规情况只报告一次，避免重复
3. 使用具体的方位和距离描述位置（如：距离基坑东南角5米处）
4. 提供详细可执行的整改方案
5. 只报告有明确图片证据的违规行为

需要检查的安全场景和标准如下：

场景：基坑临边防护
关键词：基坑, 临边, 防护栏, 围挡, 警示带, 防护网
检查标准：
- 防护栏杆要求：
  高度要求, 横杆设置, 立杆间距, 连接牢固, 完整性
  判定标准：
    · 高度要求: 防护栏杆总高度不低于1.2m
    · 违规表现: 防护栏杆高度低于1.2m, 防护栏杆倾斜变形, 防护栏杆缺失
    · 横杆设置: 必须设置上横杆（1.2m）、中横杆（0.6m）、下横杆（0.2m）
    · 违规表现: 横杆数量不足三道, 横杆间距不均匀, 横杆松动或缺失
    · 立杆间距: 立杆间距不大于2m，基础稳固
    · 违规表现: 立杆间距超过2m, 立杆基础不稳, 立杆倾斜变形
- 警示设施要求：
  警示标志, 警示灯, 警示带, 夜间照明
  判定标准：
    · 警示标志: 每20米设置一个警示标志，标志完整清晰
    · 违规表现: 警示标志缺失, 标志破损不清, 间距过大
    · 夜间警示: 夜间必须设置警示灯和足够照明，照度不低于50勒克斯
    · 违规表现: 警示灯缺失, 照明不足, 设施损坏
风险等级：high
违规类型：临边防护不到位
相关规范：{'name': '《建设工程安全生产管理条例》', 'clause': '第二十七条', 'content': '施工单位必须在施工现场设置安全防护设施，并按照规定在施工现场设置安全警示标志。'}


场景：个人防护用品违规
关键词：安全帽, 反光衣, 安全带, 防护手套, 防护鞋
检查标准：
- 安全帽要求：
  佩戴情况, 帽带系扣, 帽体完好, 佩戴方式
  判定标准：
    · 佩戴要求: 进入施工现场必须佩戴安全帽，帽带系紧，前后方向正确
    · 违规表现: 未佩戴安全帽, 帽带未系, 帽子歪戴或后戴, 非标准安全帽
- 反光衣要求：
  穿戴情况, 反光条, 尺寸合适, 整洁完好
  判定标准：
    · 穿戴要求: 施工现场必须穿着反光衣，衣服整洁完好，反光条清晰可见
    · 违规表现: 未穿反光衣, 反光条破损, 尺寸不合适, 衣服污损
风险等级：high
违规类型：劳动防护用品使用不规范
相关规范：{'name': '《建设工程安全生产管理条例》', 'clause': '第三十五条', 'content': '施工单位应当为施工现场工作人员提供符合标准的安全防护用具，并监督工作人员正确使用。'}


场景：吊装作业违规
关键词：吊装, 起重, 吊车, 塔吊, 吊钩
检查标准：
- 作业管理要求：
  指挥人员, 信号传递, 警戒区域, 重量标识
  判定标准：
    · 人员配置: 必须配备持证指挥人员和信号工，严禁无关人员进入吊装区域
    · 违规表现: 无指挥人员, 无信号工, 警戒不到位
- 设备状态要求：
  吊具完好, 钢丝绳, 安全装置, 限位保护
  判定标准：
    · 设备检查: 作业前必须检查设备状态，确保各项安全装置完好有效
    · 违规表现: 吊具破损, 钢丝绳磨损, 限位失效
风险等级：high
违规类型：吊装作业不规范
相关规范：{'name': '《建筑机械使用安全技术规程》', 'clause': 'JGJ33-2012', 'content': '起重吊装作业必须由专业人员操作，并严格执行安全技术规程。'}


当前存在的隐患：
- 隐患ID：5dcba091-4331-4c73-ab53-68b1b13dacd3
  类型：个人防护用品违规
  位置：现场右侧，靠近基坑处
  风险等级：high
  
- 隐患ID：b694ce4e-995f-4ede-823a-c49bcb15d3ae
  类型：个人防护用品违规
  位置：现场左侧，靠近基坑处
  风险等级：high
  
- 隐患ID：30fb2176-40b2-4db4-9137-2292897c55fd
  类型：个人防护用品违规
  位置：现场右侧，靠近基坑处
  风险等级：high
  
- 隐患ID：fb746744-0bda-4b14-bd87-0480db1385fe
  类型：个人防护用品违规
  位置：现场左侧，靠近基坑处
  风险等级：high
  
- 隐患ID：1ccd4b4e-97a0-4e76-80c0-99a8d148d7d7
  类型：个人防护用品违规
  位置：现场左侧，靠近基坑处
  风险等级：high
  
- 隐患ID：6fff3779-fca0-49dc-aabe-b34edf2953bd
  类型：个人防护用品违规
  位置：现场左侧，靠近基坑处
  风险等级：high
  
- 隐患ID：da54e22a-1d99-4bb2-a9fb-cee0cffc4d67
  类型：个人防护用品违规
  位置：现场左侧，靠近基坑处
  风险等级：high
  
- 隐患ID：80e93031-0512-4551-94fe-bee1c5216af1
  类型：劳动防护用品使用不规范
  位置：现场右侧，靠近基坑处，距边缘约2米处
  风险等级：high
  
- 隐患ID：b027b95e-bf68-4a22-93ac-d9c4da0c90b0
  类型：劳动防护用品使用不规范
  位置：现场中间，靠近基坑处
  风险等级：high
  
- 隐患ID：4487ce9c-8182-4271-8057-0ed7ceeaf7da
  类型：临边防护不到位
  位置：基坑东北角
  风险等级：high
  
- 隐患ID：355eb41e-93b2-4259-9169-8a7d5bb713a5
  类型：个人防护用品违规
  位置：现场左侧，靠近基坑处
  风险等级：high
  
- 隐患ID：34e980ed-5cd0-460d-948d-9c14b52c96de
  类型：劳动防护用品使用不规范
  位置：现场中间，靠近基坑处
  风险等级：high
  
- 隐患ID：49114809-96e8-4976-85cc-60f45cf6b946
  类型：临边防护不到位
  位置：基坑东南角，距边缘约5米处
  风险等级：high
  

请仔细分析图片并：
1. 对每个监控场景：
   - 仔细观察是否存在违规行为
   - 确保有明确的图片证据
   - 准确描述违规位置（使用具体的方位和距离）
   - 按标准评估风险等级

2. 对已存在的隐患：
   - 验证是否仍然存在
   - 详细描述当前状态
   - 提供具体可执行的整改方案，包括：
     · 立即整改措施（责任人、完成时限）
     · 长期解决方案（实施步骤、验收标准）

3. 对新发现的隐患：
   - 确保有明确的图片证据
   - 精确描述违规位置和情况
   - 提供详细的整改建议，包括：
     · 紧急处置措施
     · 系统性解决方案
     · 防止复发的管理建议

4. 生成语音警告：
   - 针对高风险违规优先警告
   - 包含具体的位置和违规描述
   - 提供明确的整改要求和时限

请按以下JSON格式提供分析结果：
{
    "existing_hazards": [
        {
            "hazard_id": "string",
            "status": "active|resolved",
            "current_state": "详细描述当前状态",
            "recommendation": {
                "immediate_action": {
                    "action": "立即采取的措施",
                    "responsible": "责任人",
                    "deadline": "完成时限"
                },
                "long_term_solution": {
                    "solution": "长期解决方案",
                    "steps": ["具体实施步骤"],
                    "criteria": "验收标准"
                }
            }
        }
    ],
    "new_hazards": [
        {
            "scene_id": "string",
            "violation_type": "违规类型",
            "location": "具体位置描述（包含方位和距离）",
            "risk_level": "high|medium|low",
            "evidence": "图片中的具体违规证据描述",
            "description": "详细的违规描述",
            "regulation_reference": "违反的具体规范条款",
            "recommendation": {
                "immediate_action": {
                    "action": "立即采取的措施",
                    "responsible": "责任人",
                    "deadline": "完成时限"
                },
                "long_term_solution": {
                    "solution": "长期解决方案",
                    "steps": ["具体实施步骤"],
                    "criteria": "验收标准"
                }
            }
        }
    ],
    "voice_warnings": [
        {
            "target": "hazard_id或new",
            "message": "警告内容（包含位置、违规描述和整改要求）",
            "urgency": "high|medium|low"
        }
    ]
}

注意事项：
1. 位置描述必须包含具体的方位和距离信息
2. 整改建议必须明确责任人和完成时限
3. 避免重复报告相同的违规情况
4. 确保每个识别的违规都有确切的图片证据
5. 优先关注可能导致重大安全事故的隐患
6. 所有描述和建议必须使用中文
7. 提供的整改措施必须具体可执行
8. 验收标准必须可量化、可检查

2024-12-03 11:07:03,955 - ai_service - INFO - --------------------------------------------------
2024-12-03 11:08:40,111 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 11:08:40,117 - ai_service - INFO - AI响应结果:
2024-12-03 11:08:40,117 - ai_service - INFO - ```json
{
    "existing_hazards": [
        {
            "hazard_id": "5dcba091-4331-4c73-ab53-68b1b13dacd3",
            "status": "active",
            "current_state": "现场右侧靠近基坑处，有两名工人未佩戴安全帽，其中一名工人正在操作设备。",
            "recommendation": {
                "immediate_action": {
                    "action": "立即要求所有未佩戴安全帽的人员停止作业，并佩戴好安全帽。",
                    "responsible": "安全员",
                    "deadline": "立即执行"
                },
                "long_term_solution": {
                    "solution": "加强对现场人员佩戴安全帽的监督和检查。",
                    "steps": ["每日开工前检查所有人员的安全帽佩戴情况", "定期对现场人员进行安全培训"],
                    "criteria": "安全帽佩戴率达到100%"
                }
            }
        },
        {
            "hazard_id": "b694ce4e-995f-4ede-823a-c49bcb15d3ae",
            "status": "active",
            "current_state": "现场左侧靠近基坑处，有一名工人未佩戴安全帽。",
            "recommendation": {
                "immediate_action": {
                    "action": "立即要求该名工人停止作业，并佩戴好安全帽。",
                    "responsible": "安全员",
                    "deadline": "立即执行"
                },
                "long_term_solution": {
                    "solution": "加强对现场人员佩戴安全帽的监督和检查。",
                    "steps": ["每日开工前检查所有人员的安全帽佩戴情况", "定期对现场人员进行安全培训"],
                    "criteria": "安全帽佩戴率达到100%"
                }
            }
        },
        {
            "hazard_id": "30fb2176-40b2-4db4-9137-2292897c55fd",
            "status": "active",
            "current_state": "现场右侧靠近基坑处，有一名工人未佩戴安全帽。",
            "recommendation": {
                "immediate_action": {
                    "action": "立即要求该名工人停止作业，并佩戴好安全帽。",
                    "responsible": "安全员",
                    "deadline": "立即执行"
                },
                "long_term_solution": {
                    "solution": "加强对现场人员佩戴安全帽的监督和检查。",
                    "steps": ["每日开工前检查所有人员的安全帽佩戴情况", "定期对现场人员进行安全培训"],
                    "criteria": "安全帽佩戴率达到100%"
                }
            }
        },
        {
            "hazard_id": "fb746744-0bda-4b14-bd87-0480db1385fe",
            "status": "active",
            "current_state": "现场左侧靠近基坑处，有一名工人未佩戴安全帽。",
            "recommendation": {
                "immediate_action": {
                    "action": "立即要求该名工人停止作业，并佩戴好安全帽。",
                    "responsible": "安全员",
                    "deadline": "立即执行"
                },
                "long_term_solution": {
                    "solution": "加强对现场人员佩戴安全帽的监督和检查。",
                    "steps": ["每日开工前检查所有人员的安全帽佩戴情况", "定期对现场人员进行安全培训"],
                    "criteria": "安全帽佩戴率达到100%"
                }
            }
        },
        {
            "hazard_id": "1ccd4b4e-97a0-4e76-80c0-99a8d148d7d7",
            "status": "active",
            "current_state": "现场左侧靠近基坑处，有一名工人未佩戴安全帽。",
            "recommendation": {
                "immediate_action": {
                    "action": "立即要求该名工人停止作业，并佩戴好安全帽。",
                    "responsible": "安全员",
                    "deadline": "立即执行"
                },
                "long_term_solution": {
                    "solution": "加强对现场人员佩戴安全帽的监督和检查。",
                    "steps": ["每日开工前检查所有人员的安全帽佩戴情况", "定期对现场人员进行安全培训"],
                    "criteria": "安全帽佩戴率达到100%"
                }
            }
        },
        {
            "hazard_id": "6fff3779-fca0-49dc-aabe-b34edf2953bd",
            "status": "active",
            "current_state": "现场左侧靠近基坑处，有一名工人未佩戴安全帽。",
            "recommendation": {
                "immediate_action": {
                    "action": "立即要求该名工人停止作业，并佩戴好安全帽。",
                    "responsible": "安全员",
                    "deadline": "立即执行"
                },
                "long_term_solution": {
                    "solution": "加强对现场人员佩戴安全帽的监督和检查。",
                    "steps": ["每日开工前检查所有人员的安全帽佩戴情况", "定期对现场人员进行安全培训"],
                    "criteria": "安全帽佩戴率达到100%"
                }
            }
        },
        {
            "hazard_id": "da54e22a-1d99-4bb2-a9fb-cee0cffc4d67",
            "status": "active",
            "current_state": "现场左侧靠近基坑处，有一名工人未佩戴安全帽。",
            "recommendation": {
                "immediate_action": {
                    "action": "立即要求该名工人停止作业，并佩戴好安全帽。",
                    "responsible": "安全员",
                    "deadline": "立即执行"
                },
                "long_term_solution": {
                    "solution": "加强对现场人员佩戴安全帽的监督和检查。",
                    "steps": ["每日开工前检查所有人员的安全帽佩戴情况", "定期对现场人员进行安全培训"],
                    "criteria": "安全帽佩戴率达到100%"
                }
            }
        },
        {
            "hazard_id": "80e93031-0512-4551-94fe-bee1c5216af1",
            "status": "active",
            "current_state": "现场右侧靠近基坑处，距边缘约2米处，有一名工人未穿反光衣。",
            "recommendation": {
                "immediate_action": {
                    "action": "立即要求该名工人停止作业，并穿上反光衣。",
                    "responsible": "安全员",
                    "deadline": "立即执行"
                },
                "long_term_solution": {
                    "solution": "加强对现场人员穿戴反光衣的监督和检查。",
                    "steps": ["每日开工前检查所有人员的反光衣穿戴情况", "定期对现场人员进行安全培训"],
                    "criteria": "反光衣穿戴率达到100%"
                }
            }
        },
        {
            "hazard_id": "b027b95e-bf68-4a22-93ac-d9c4da0c90b0",
            "status": "active",
            "current_state": "现场中间靠近基坑处，有一名工人未穿反光衣。",
            "recommendation": {
                "immediate_action": {
                    "action": "立即要求该名工人停止作业，并穿上反光衣。",
                    "responsible": "安全员",
                    "deadline": "立即执行"
                },
                "long_term_solution": {
                    "solution": "加强对现场人员穿戴反光衣的监督和检查。",
                    "steps": ["每日开工前检查所有人员的反光衣穿戴情况", "定期对现场人员进行安全培训"],
                    "criteria": "反光衣穿戴率达到100%"
                }
            }
        },
        {
            "hazard_id": "4487ce9c-8182-4271-8057-0ed7ceeaf7da",
            "status": "active",
            "current_state": "基坑东北角，临边防护栏高度低于1.2米。",
            "recommendation": {
                "immediate_action": {
                    "action": "立即停止基坑周边的作业，并加固防护栏至规定高度。",
                    "responsible": "施工负责人",
                    "deadline": "48小时内"
                },
                "long_term_solution": {
                    "solution": "定期检查和维护基坑临边防护设施。",
                    "steps": ["每周检查一次防护栏的高度和牢固性", "发现问题及时整改"],
                    "criteria": "防护栏高度达到1.2米，牢固可靠"
                }
            }
        },
        {
            "hazard_id": "355eb41e-93b2-4259-9169-8a7d5bb713a5",
            "status": "active",
            "current_state": "现场左侧靠近基坑处，有一名工人未佩戴安全帽。",
            "recommendation": {
                "immediate_action": {
                    "action": "立即要求该名工人停止作业，并佩戴好安全帽。",
                    "responsible": "安全员",
                    "deadline": "立即执行"
                },
                "long_term_solution": {
                    "solution": "加强对现场人员佩戴安全帽的监督和检查。",
                    "steps": ["每日开工前检查所有人员的安全帽佩戴情况", "定期对现场人员进行安全培训"],
                    "criteria": "安全帽佩戴率达到100%"
                }
            }
        },
        {
            "hazard_id": "34e980ed-5cd0-460d-948d-9c14b52c96de",
            "status": "active",
            "current_state": "现场中间靠近基坑处，有一名工人未穿反光衣。",
            "recommendation": {
                "immediate_action": {
                    "action": "立即要求该名工人停止作业，并穿上反光衣。",
                    "responsible": "安全员",
                    "deadline": "立即执行"
                },
                "long_term_solution": {
                    "solution": "加强对现场人员穿戴反光衣的监督和检查。",
                    "steps": ["每日开工前检查所有人员的反光衣穿戴情况", "定期对现场人员进行安全培训"],
                    "criteria": "反光衣穿戴率达到100%"
                }
            }
        },
        {
            "hazard_id": "49114809-96e8-4976-85cc-60f45cf6b946",
            "status": "active",
            "current_state": "基坑东南角，距边缘约5米处，临边防护栏缺失。",
            "recommendation": {
                "immediate_action": {
                    "action": "立即停止基坑周边的作业，并设置临时防护措施。",
                    "responsible": "施工负责人",
                    "deadline": "24小时内"
                },
                "long_term_solution": {
                    "solution": "重新安装符合要求的临边防护栏。",
                    "steps": ["采购符合要求的防护栏材料", "组织人员安装"],
                    "criteria": "防护栏高度达到1.2米，牢固可靠，无缺失"
                }
            }
        }
    ],
    "new_hazards": [
        {
            "scene_id": "new1",
            "violation_type": "个人防护用品违规",
            "location": "现场右侧，靠近基坑处，距边缘约2米处",
            "risk_level": "high",
            "evidence": "图片中显示有两名工人未佩戴安全帽，其中一名工人正在操作设备。",
            "description": "现场右侧靠近基坑处，有两名工人未佩戴安全帽，其中一名工人正在操作设备。",
            "regulation_reference": {
                "name": "《建设工程安全生产管理条例》",
                "clause": "第三十五条",
                "content": "施工单位应当为施工现场工作人员提供符合标准的安全防护用具，并监督工作人员正确使用。"
            },
            "recommendation": {
                "immediate_action": {
                    "action": "立即要求所有未佩戴安全帽的人员停止作业，并佩戴好安全帽。",
                    "responsible": "安全员",
                    "deadline": "立即执行"
                },
                "long_term_solution": {
                    "solution": "加强对现场人员佩戴安全帽的监督和检查。",
                    "steps": ["每日开工前检查所有人员的安全帽佩戴情况", "定期对现场人员进行安全培训"],
                    "criteria": "安全帽佩戴率达到100%"
                }
            }
        },
        {
            "scene_id": "new2",
            "violation_type": "个人防护用品违规",
            "location": "现场中间，靠近基坑处",
            "risk_level": "high",
            "evidence": "图片中显示有一名工人未穿反光衣。",
            "description": "现场中间靠近基坑处，有一名工人未穿反光衣。",
            "regulation_reference": {
                "name": "《建设工程安全生产管理条例》",
                "clause": "第三十五条",
                "content": "施工单位应当为施工现场工作人员提供符合标准的安全防护用具，并监督工作人员正确使用。"
            },
            "recommendation": {
                "immediate_action": {
                    "action": "立即要求该名工人停止作业，并穿上反光衣。",
                    "responsible": "安全员",
                    "deadline": "立即执行"
                },
                "long_term_solution": {
                    "solution": "加强对现场人员穿戴反光衣的监督和检查。",
                    "steps": ["每日开工前检查所有人员的反光衣穿戴情况", "定期对现场人员进行安全培训"],
                    "criteria": "反光衣穿戴率达到100%"
                }
            }
        },
        {
            "scene_id": "new3",
            "violation_type": "临边防护不到位",
            "location": "基坑东南角，距边缘约5米处",
            "risk_level": "high",
            "evidence": "图片中显示基坑东南角的临边防护栏缺失。",
            "description": "基坑东南角，距边缘约5米处，临边防护栏缺失。",
            "regulation_reference": {
                "name": "《建设工程安全生产管理条例》",
                "clause": "第二十七条",
                "content": "施工单位必须在施工现场设置安全防护设施，并按照规定在施工现场设置安全警示标志。"
            },
            "recommendation": {
                "immediate_action": {
                    "action": "立即停止基坑周边的作业，并设置临时防护措施。",
                    "responsible": "施工负责人",
                    "deadline": "24小时内"
                },
                "long_term_solution": {
                    "solution": "重新安装符合要求的临边防护栏。",
                    "steps": ["采购符合要求的防护栏材料", "组织人员安装"],
                    "criteria": "防护栏高度达到1.2米，牢固可靠，无缺失"
                }
            }
        }
    ],
    "voice_warnings": [
        {
            "target": "new1",
            "message": "现场右侧靠近基坑处，有两名工人未佩戴安全帽，其中一名工人正在操作设备。立即要求所有未佩戴安全帽的人员停止作业，并佩戴好安全帽。",
            "urgency": "high"
        },
        {
            "target": "new2",
            "message": "现场中间靠近基坑处，有一名工人未穿反光衣。立即要求该名工人停止作业，并穿上反光衣。",
            "urgency": "high"
        },
        {
            "target": "new3",
            "message": "基坑东南角，距边缘约5米处，临边防护栏缺失。立即停止基坑周边的作业，并设置临时防护措施。",
            "urgency": "high"
        }
    ]
}
```
2024-12-03 11:08:40,117 - ai_service - INFO - ==================================================
2024-12-03 11:08:40,121 - sqlalchemy.engine.Engine - INFO - SELECT hazards.hazard_id AS hazards_hazard_id, hazards.camera_id AS hazards_camera_id, hazards.scene_id AS hazards_scene_id, hazards.location AS hazards_location, hazards.violation_type AS hazards_violation_type, hazards.risk_level AS hazards_risk_level, hazards.status AS hazards_status, hazards.detected_at AS hazards_detected_at, hazards.resolved_at AS hazards_resolved_at, hazards.id AS hazards_id, hazards.created_at AS hazards_created_at, hazards.updated_at AS hazards_updated_at 
FROM hazards 
WHERE hazards.id = ?
2024-12-03 11:08:40,121 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] ('5dcba091-4331-4c73-ab53-68b1b13dacd3',)
2024-12-03 11:08:40,122 - sqlalchemy.engine.Engine - INFO - SELECT hazards.hazard_id AS hazards_hazard_id, hazards.camera_id AS hazards_camera_id, hazards.scene_id AS hazards_scene_id, hazards.location AS hazards_location, hazards.violation_type AS hazards_violation_type, hazards.risk_level AS hazards_risk_level, hazards.status AS hazards_status, hazards.detected_at AS hazards_detected_at, hazards.resolved_at AS hazards_resolved_at, hazards.id AS hazards_id, hazards.created_at AS hazards_created_at, hazards.updated_at AS hazards_updated_at 
FROM hazards 
WHERE hazards.id = ?
2024-12-03 11:08:40,122 - sqlalchemy.engine.Engine - INFO - [cached since 0.001628s ago] ('b694ce4e-995f-4ede-823a-c49bcb15d3ae',)
2024-12-03 11:08:40,123 - sqlalchemy.engine.Engine - INFO - SELECT hazards.hazard_id AS hazards_hazard_id, hazards.camera_id AS hazards_camera_id, hazards.scene_id AS hazards_scene_id, hazards.location AS hazards_location, hazards.violation_type AS hazards_violation_type, hazards.risk_level AS hazards_risk_level, hazards.status AS hazards_status, hazards.detected_at AS hazards_detected_at, hazards.resolved_at AS hazards_resolved_at, hazards.id AS hazards_id, hazards.created_at AS hazards_created_at, hazards.updated_at AS hazards_updated_at 
FROM hazards 
WHERE hazards.id = ?
2024-12-03 11:08:40,123 - sqlalchemy.engine.Engine - INFO - [cached since 0.002716s ago] ('30fb2176-40b2-4db4-9137-2292897c55fd',)
2024-12-03 11:08:40,125 - sqlalchemy.engine.Engine - INFO - SELECT hazards.hazard_id AS hazards_hazard_id, hazards.camera_id AS hazards_camera_id, hazards.scene_id AS hazards_scene_id, hazards.location AS hazards_location, hazards.violation_type AS hazards_violation_type, hazards.risk_level AS hazards_risk_level, hazards.status AS hazards_status, hazards.detected_at AS hazards_detected_at, hazards.resolved_at AS hazards_resolved_at, hazards.id AS hazards_id, hazards.created_at AS hazards_created_at, hazards.updated_at AS hazards_updated_at 
FROM hazards 
WHERE hazards.id = ?
2024-12-03 11:08:40,127 - sqlalchemy.engine.Engine - INFO - [cached since 0.006543s ago] ('fb746744-0bda-4b14-bd87-0480db1385fe',)
2024-12-03 11:08:40,129 - sqlalchemy.engine.Engine - INFO - SELECT hazards.hazard_id AS hazards_hazard_id, hazards.camera_id AS hazards_camera_id, hazards.scene_id AS hazards_scene_id, hazards.location AS hazards_location, hazards.violation_type AS hazards_violation_type, hazards.risk_level AS hazards_risk_level, hazards.status AS hazards_status, hazards.detected_at AS hazards_detected_at, hazards.resolved_at AS hazards_resolved_at, hazards.id AS hazards_id, hazards.created_at AS hazards_created_at, hazards.updated_at AS hazards_updated_at 
FROM hazards 
WHERE hazards.id = ?
2024-12-03 11:08:40,130 - sqlalchemy.engine.Engine - INFO - [cached since 0.00894s ago] ('1ccd4b4e-97a0-4e76-80c0-99a8d148d7d7',)
2024-12-03 11:08:40,131 - sqlalchemy.engine.Engine - INFO - SELECT hazards.hazard_id AS hazards_hazard_id, hazards.camera_id AS hazards_camera_id, hazards.scene_id AS hazards_scene_id, hazards.location AS hazards_location, hazards.violation_type AS hazards_violation_type, hazards.risk_level AS hazards_risk_level, hazards.status AS hazards_status, hazards.detected_at AS hazards_detected_at, hazards.resolved_at AS hazards_resolved_at, hazards.id AS hazards_id, hazards.created_at AS hazards_created_at, hazards.updated_at AS hazards_updated_at 
FROM hazards 
WHERE hazards.id = ?
2024-12-03 11:08:40,132 - sqlalchemy.engine.Engine - INFO - [cached since 0.01104s ago] ('6fff3779-fca0-49dc-aabe-b34edf2953bd',)
2024-12-03 11:08:40,133 - sqlalchemy.engine.Engine - INFO - SELECT hazards.hazard_id AS hazards_hazard_id, hazards.camera_id AS hazards_camera_id, hazards.scene_id AS hazards_scene_id, hazards.location AS hazards_location, hazards.violation_type AS hazards_violation_type, hazards.risk_level AS hazards_risk_level, hazards.status AS hazards_status, hazards.detected_at AS hazards_detected_at, hazards.resolved_at AS hazards_resolved_at, hazards.id AS hazards_id, hazards.created_at AS hazards_created_at, hazards.updated_at AS hazards_updated_at 
FROM hazards 
WHERE hazards.id = ?
2024-12-03 11:08:40,133 - sqlalchemy.engine.Engine - INFO - [cached since 0.01245s ago] ('da54e22a-1d99-4bb2-a9fb-cee0cffc4d67',)
2024-12-03 11:08:40,134 - sqlalchemy.engine.Engine - INFO - SELECT hazards.hazard_id AS hazards_hazard_id, hazards.camera_id AS hazards_camera_id, hazards.scene_id AS hazards_scene_id, hazards.location AS hazards_location, hazards.violation_type AS hazards_violation_type, hazards.risk_level AS hazards_risk_level, hazards.status AS hazards_status, hazards.detected_at AS hazards_detected_at, hazards.resolved_at AS hazards_resolved_at, hazards.id AS hazards_id, hazards.created_at AS hazards_created_at, hazards.updated_at AS hazards_updated_at 
FROM hazards 
WHERE hazards.id = ?
2024-12-03 11:08:40,134 - sqlalchemy.engine.Engine - INFO - [cached since 0.01345s ago] ('80e93031-0512-4551-94fe-bee1c5216af1',)
2024-12-03 11:08:40,135 - sqlalchemy.engine.Engine - INFO - SELECT hazards.hazard_id AS hazards_hazard_id, hazards.camera_id AS hazards_camera_id, hazards.scene_id AS hazards_scene_id, hazards.location AS hazards_location, hazards.violation_type AS hazards_violation_type, hazards.risk_level AS hazards_risk_level, hazards.status AS hazards_status, hazards.detected_at AS hazards_detected_at, hazards.resolved_at AS hazards_resolved_at, hazards.id AS hazards_id, hazards.created_at AS hazards_created_at, hazards.updated_at AS hazards_updated_at 
FROM hazards 
WHERE hazards.id = ?
2024-12-03 11:08:40,135 - sqlalchemy.engine.Engine - INFO - [cached since 0.01423s ago] ('b027b95e-bf68-4a22-93ac-d9c4da0c90b0',)
2024-12-03 11:08:40,136 - sqlalchemy.engine.Engine - INFO - SELECT hazards.hazard_id AS hazards_hazard_id, hazards.camera_id AS hazards_camera_id, hazards.scene_id AS hazards_scene_id, hazards.location AS hazards_location, hazards.violation_type AS hazards_violation_type, hazards.risk_level AS hazards_risk_level, hazards.status AS hazards_status, hazards.detected_at AS hazards_detected_at, hazards.resolved_at AS hazards_resolved_at, hazards.id AS hazards_id, hazards.created_at AS hazards_created_at, hazards.updated_at AS hazards_updated_at 
FROM hazards 
WHERE hazards.id = ?
2024-12-03 11:08:40,136 - sqlalchemy.engine.Engine - INFO - [cached since 0.0152s ago] ('4487ce9c-8182-4271-8057-0ed7ceeaf7da',)
2024-12-03 11:08:40,137 - sqlalchemy.engine.Engine - INFO - SELECT hazards.hazard_id AS hazards_hazard_id, hazards.camera_id AS hazards_camera_id, hazards.scene_id AS hazards_scene_id, hazards.location AS hazards_location, hazards.violation_type AS hazards_violation_type, hazards.risk_level AS hazards_risk_level, hazards.status AS hazards_status, hazards.detected_at AS hazards_detected_at, hazards.resolved_at AS hazards_resolved_at, hazards.id AS hazards_id, hazards.created_at AS hazards_created_at, hazards.updated_at AS hazards_updated_at 
FROM hazards 
WHERE hazards.id = ?
2024-12-03 11:08:40,137 - sqlalchemy.engine.Engine - INFO - [cached since 0.0166s ago] ('355eb41e-93b2-4259-9169-8a7d5bb713a5',)
2024-12-03 11:08:40,139 - sqlalchemy.engine.Engine - INFO - SELECT hazards.hazard_id AS hazards_hazard_id, hazards.camera_id AS hazards_camera_id, hazards.scene_id AS hazards_scene_id, hazards.location AS hazards_location, hazards.violation_type AS hazards_violation_type, hazards.risk_level AS hazards_risk_level, hazards.status AS hazards_status, hazards.detected_at AS hazards_detected_at, hazards.resolved_at AS hazards_resolved_at, hazards.id AS hazards_id, hazards.created_at AS hazards_created_at, hazards.updated_at AS hazards_updated_at 
FROM hazards 
WHERE hazards.id = ?
2024-12-03 11:08:40,139 - sqlalchemy.engine.Engine - INFO - [cached since 0.0182s ago] ('34e980ed-5cd0-460d-948d-9c14b52c96de',)
2024-12-03 11:08:40,140 - sqlalchemy.engine.Engine - INFO - SELECT hazards.hazard_id AS hazards_hazard_id, hazards.camera_id AS hazards_camera_id, hazards.scene_id AS hazards_scene_id, hazards.location AS hazards_location, hazards.violation_type AS hazards_violation_type, hazards.risk_level AS hazards_risk_level, hazards.status AS hazards_status, hazards.detected_at AS hazards_detected_at, hazards.resolved_at AS hazards_resolved_at, hazards.id AS hazards_id, hazards.created_at AS hazards_created_at, hazards.updated_at AS hazards_updated_at 
FROM hazards 
WHERE hazards.id = ?
2024-12-03 11:08:40,140 - sqlalchemy.engine.Engine - INFO - [cached since 0.0194s ago] ('49114809-96e8-4976-85cc-60f45cf6b946',)
2024-12-03 11:08:40,142 - sqlalchemy.engine.Engine - INFO - INSERT INTO hazards (hazard_id, camera_id, scene_id, location, violation_type, risk_level, status, detected_at, resolved_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2024-12-03 11:08:40,143 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ('bb8ea944-b943-493f-83ae-57f06681dd1b', '001', 'new1', '现场右侧，靠近基坑处，距边缘约2米处', '个人防护用品违规', 'high', 'active', '2024-12-03 03:08:40.141303', None, '2024-12-03 03:08:40.142915', '2024-12-03 03:08:40.142916')
2024-12-03 11:08:40,144 - sqlalchemy.engine.Engine - INFO - INSERT INTO hazard_tracks (hazard_id, status, details, tracked_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?)
2024-12-03 11:08:40,144 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ('bb8ea944-b943-493f-83ae-57f06681dd1b', 'active', "Description: 现场右侧靠近基坑处，有两名工人未佩戴安全帽，其中一名工人正在操作设备。\nRegulation: {'name': '《建设工程安全生产管理条例》', 'clause': '第三十五条', 'content': '施工单位应当为施工现场工作人员提供符合标准的安全防护用具，并监督工作人员正确使用。'}\nLocation: 现场右侧，靠近基坑处，距边缘约2米处\nRisk Level: high", '2024-12-03 03:08:40.144588', '2024-12-03 03:08:40.144590', '2024-12-03 03:08:40.144590')
2024-12-03 11:08:40,145 - sqlalchemy.engine.Engine - INFO - COMMIT
2024-12-03 11:08:40,147 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2024-12-03 11:08:40,147 - sqlalchemy.engine.Engine - INFO - INSERT INTO hazards (hazard_id, camera_id, scene_id, location, violation_type, risk_level, status, detected_at, resolved_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2024-12-03 11:08:40,147 - sqlalchemy.engine.Engine - INFO - [cached since 0.004451s ago] ('e5e01816-2641-4d77-b890-d1f3d2b0ae5c', '001', 'new2', '现场中间，靠近基坑处', '个人防护用品违规', 'high', 'active', '2024-12-03 03:08:40.146327', None, '2024-12-03 03:08:40.147205', '2024-12-03 03:08:40.147206')
2024-12-03 11:08:40,148 - sqlalchemy.engine.Engine - INFO - INSERT INTO hazard_tracks (hazard_id, status, details, tracked_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?)
2024-12-03 11:08:40,148 - sqlalchemy.engine.Engine - INFO - [cached since 0.003636s ago] ('e5e01816-2641-4d77-b890-d1f3d2b0ae5c', 'active', "Description: 现场中间靠近基坑处，有一名工人未穿反光衣。\nRegulation: {'name': '《建设工程安全生产管理条例》', 'clause': '第三十五条', 'content': '施工单位应当为施工现场工作人员提供符合标准的安全防护用具，并监督工作人员正确使用。'}\nLocation: 现场中间，靠近基坑处\nRisk Level: high", '2024-12-03 03:08:40.148106', '2024-12-03 03:08:40.148107', '2024-12-03 03:08:40.148107')
2024-12-03 11:08:40,148 - sqlalchemy.engine.Engine - INFO - COMMIT
2024-12-03 11:08:40,149 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2024-12-03 11:08:40,149 - sqlalchemy.engine.Engine - INFO - INSERT INTO hazards (hazard_id, camera_id, scene_id, location, violation_type, risk_level, status, detected_at, resolved_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2024-12-03 11:08:40,149 - sqlalchemy.engine.Engine - INFO - [cached since 0.007065s ago] ('4b98bdaa-9e8d-4ac0-9268-326cfa23b146', '001', 'new3', '基坑东南角，距边缘约5米处', '临边防护不到位', 'high', 'active', '2024-12-03 03:08:40.149237', None, '2024-12-03 03:08:40.149832', '2024-12-03 03:08:40.149833')
2024-12-03 11:08:40,150 - sqlalchemy.engine.Engine - INFO - INSERT INTO hazard_tracks (hazard_id, status, details, tracked_at, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?)
2024-12-03 11:08:40,150 - sqlalchemy.engine.Engine - INFO - [cached since 0.006157s ago] ('4b98bdaa-9e8d-4ac0-9268-326cfa23b146', 'active', "Description: 基坑东南角，距边缘约5米处，临边防护栏缺失。\nRegulation: {'name': '《建设工程安全生产管理条例》', 'clause': '第二十七条', 'content': '施工单位必须在施工现场设置安全防护设施，并按照规定在施工现场设置安全警示标志。'}\nLocation: 基坑东南角，距边缘约5米处\nRisk Level: high", '2024-12-03 03:08:40.150640', '2024-12-03 03:08:40.150641', '2024-12-03 03:08:40.150641')
2024-12-03 11:08:40,151 - sqlalchemy.engine.Engine - INFO - COMMIT
2024-12-03 11:10:42,475 - app.services.scene_tracker - INFO - No history found for scene 002
2024-12-03 11:10:53,349 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 11:10:53,353 - app.services.scene_tracker - INFO - Creating new scene record for 002
2024-12-03 11:10:53,356 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 11:10:53,356 - app.services.scene_tracker - INFO - Updated state for scene 002
2024-12-03 11:17:20,026 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 11:17:20,032 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 11:17:20,032 - app.services.scene_tracker - INFO - Updated state for scene 002
2024-12-03 11:17:50,438 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 11:17:50,443 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 11:17:50,444 - app.services.scene_tracker - INFO - Updated state for scene 002
2024-12-03 11:18:27,710 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 11:18:27,718 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 11:18:27,718 - app.services.scene_tracker - INFO - Updated state for scene 002
2024-12-03 13:11:49,271 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:11:49,279 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:11:49,279 - app.services.scene_tracker - INFO - Updated state for scene 002
2024-12-03 13:12:46,923 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:12:46,930 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:12:46,931 - app.services.scene_tracker - INFO - Updated state for scene 002
2024-12-03 13:13:47,110 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:13:47,112 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:13:47,112 - app.services.scene_tracker - INFO - Updated state for scene 002
2024-12-03 13:17:10,280 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:17:10,294 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:17:10,294 - app.services.scene_tracker - INFO - Updated state for scene 002
2024-12-03 13:18:03,899 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:18:03,902 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:18:03,903 - app.services.scene_tracker - INFO - Updated state for scene 002
2024-12-03 13:20:02,942 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:20:02,944 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:20:02,944 - app.services.scene_tracker - INFO - Updated state for scene 002
2024-12-03 13:20:32,551 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:20:32,556 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:20:32,557 - app.services.scene_tracker - INFO - Updated state for scene 002
2024-12-03 13:21:08,580 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:21:08,583 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:21:08,583 - app.services.scene_tracker - INFO - Updated state for scene 002
2024-12-03 13:24:01,071 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:24:01,079 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:24:01,079 - app.services.scene_tracker - INFO - Updated state for scene 002
2024-12-03 13:30:22,507 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:30:22,512 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:30:22,512 - app.services.scene_tracker - INFO - Updated state for scene 002
2024-12-03 13:31:29,912 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:31:29,918 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:31:29,918 - app.services.scene_tracker - INFO - Updated state for scene 002
2024-12-03 13:34:19,906 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:34:19,921 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:34:19,922 - app.services.scene_tracker - INFO - Updated state for scene 002
2024-12-03 13:35:43,051 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:35:43,054 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:35:43,054 - app.services.scene_tracker - INFO - Updated state for scene 002
2024-12-03 13:37:36,174 - app.services.scene_tracker - INFO - No history found for scene 003
2024-12-03 13:37:44,515 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:37:44,518 - app.services.scene_tracker - INFO - Creating new scene record for 003
2024-12-03 13:37:44,523 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:37:44,523 - app.services.scene_tracker - INFO - Updated state for scene 003
2024-12-03 13:38:38,951 - app.services.scene_tracker - INFO - No history found for scene 004
2024-12-03 13:38:47,170 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:38:47,173 - app.services.scene_tracker - INFO - Creating new scene record for 004
2024-12-03 13:38:47,177 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:38:47,177 - app.services.scene_tracker - INFO - Updated state for scene 004
2024-12-03 13:42:19,657 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:42:19,669 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:42:19,669 - app.services.scene_tracker - INFO - Updated state for scene 004
2024-12-03 13:43:35,778 - app.services.scene_analysis_service - ERROR - Analysis failed: 'NoneType' object has no attribute 'get'
2024-12-03 13:43:39,029 - app.services.scene_analysis_service - ERROR - Analysis failed: 'NoneType' object has no attribute 'get'
2024-12-03 13:44:27,311 - app.services.scene_analysis_service - ERROR - Analysis failed: 'NoneType' object has no attribute 'get'
2024-12-03 13:44:29,571 - app.services.scene_analysis_service - ERROR - Analysis failed: 'NoneType' object has no attribute 'get'
2024-12-03 13:44:36,975 - app.services.scene_analysis_service - ERROR - Analysis failed: 'NoneType' object has no attribute 'get'
2024-12-03 13:44:41,524 - app.services.scene_tracker - INFO - No history found for scene 005
2024-12-03 13:45:02,564 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:45:02,570 - app.services.scene_tracker - INFO - Creating new scene record for 005
2024-12-03 13:45:02,572 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:45:02,572 - app.services.scene_tracker - INFO - Updated state for scene 005
2024-12-03 13:45:59,087 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:45:59,090 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:45:59,090 - app.services.scene_tracker - INFO - Updated state for scene 005
2024-12-03 13:48:17,430 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:48:17,439 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:48:17,439 - app.services.scene_tracker - INFO - Updated state for scene 005
2024-12-03 13:48:46,305 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:48:46,310 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:48:46,310 - app.services.scene_tracker - INFO - Updated state for scene 005
2024-12-03 13:49:01,112 - app.services.scene_tracker - INFO - No history found for scene 006
2024-12-03 13:49:10,884 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:49:10,888 - app.services.scene_tracker - INFO - Creating new scene record for 006
2024-12-03 13:49:10,894 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:49:10,895 - app.services.scene_tracker - INFO - Updated state for scene 006
2024-12-03 13:49:40,651 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:49:40,660 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:49:40,660 - app.services.scene_tracker - INFO - Updated state for scene 006
2024-12-03 13:52:14,796 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:52:14,807 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:52:14,807 - app.services.scene_tracker - INFO - Updated state for scene 006
2024-12-03 13:53:10,600 - httpx - INFO - HTTP Request: POST https://api.stepfun.com/v1/chat/completions "HTTP/1.1 200 OK"
2024-12-03 13:53:10,604 - app.services.scene_tracker - INFO - Scene states saved to /Users/hook/Desktop/test/secure/data/scene_states.json
2024-12-03 13:53:10,604 - app.services.scene_tracker - INFO - Updated state for scene 006
2024-12-03 15:21:11,000 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2024-12-03 15:21:11,004 - sqlalchemy.engine.Engine - INFO - SELECT cameras.camera_id, cameras.camera_name, cameras.group_id, cameras.location, cameras.status, cameras.description, cameras.id, cameras.created_at, cameras.updated_at 
FROM cameras
2024-12-03 15:21:11,004 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] ()
2024-12-03 15:21:11,009 - sqlalchemy.engine.Engine - INFO - SELECT cameras_1.id AS cameras_1_id, camera_scenes.camera_id AS camera_scenes_camera_id, camera_scenes.scene_id AS camera_scenes_scene_id, camera_scenes.id AS camera_scenes_id, camera_scenes.created_at AS camera_scenes_created_at, camera_scenes.updated_at AS camera_scenes_updated_at 
FROM cameras AS cameras_1 JOIN camera_scenes ON cameras_1.camera_id = camera_scenes.camera_id 
WHERE cameras_1.id IN (?, ?)
2024-12-03 15:21:11,009 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] (1, 2)
2024-12-03 15:21:11,013 - sqlalchemy.engine.Engine - INFO - SELECT cameras_1.id AS cameras_1_id, hazards.hazard_id AS hazards_hazard_id, hazards.camera_id AS hazards_camera_id, hazards.scene_id AS hazards_scene_id, hazards.location AS hazards_location, hazards.violation_type AS hazards_violation_type, hazards.risk_level AS hazards_risk_level, hazards.status AS hazards_status, hazards.detected_at AS hazards_detected_at, hazards.resolved_at AS hazards_resolved_at, hazards.id AS hazards_id, hazards.created_at AS hazards_created_at, hazards.updated_at AS hazards_updated_at 
FROM cameras AS cameras_1 JOIN hazards ON cameras_1.camera_id = hazards.camera_id 
WHERE cameras_1.id IN (?, ?)
2024-12-03 15:21:11,013 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (1, 2)
2024-12-03 15:21:11,015 - sqlalchemy.engine.Engine - INFO - COMMIT
